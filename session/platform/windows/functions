#!/bin/bash
####################################################################
# Prey Session Module Windows Functions - by Tomas Pollak (bootlog.org)
# URL: http://preyproject.com
# License: GPLv3
####################################################################

session__screenshot="$tmpdir/prey-screenshot"

get_uptime_and_programs() {
	uptime=`net stats srv | grep Statistics`
	running_programs=`tasklist 2> /dev/null`
}

# removed the regex for hidden files stuff
get_modified_files() {
	modified_files=`find $session__modified_files_path -type f -mmin -$session__modified_files_time 2>&1`
}

get_active_connections() {
	active_connections=`netstat -n`
}

get_screenshot() {
	"$module_platform_path/boxcutter-fs.exe" "$session__screenshot.bmp"
	bmp2png.exe "$session__screenshot.bmp" &> /dev/null
	rm "$session__screenshot.bmp"
	session__screenshot="$tmpdir/prey-screenshot.png"
}

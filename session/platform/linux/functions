#!/bin/bash
####################################################################
# Prey Session Module Linux Functions - by Tomas Pollak (bootlog.org)
# URL: http://preyproject.com
# License: GPLv3
####################################################################

get_active_connections() {
	active_connections=`netstat -tupn | grep -v "127.0.0.1"`
}

get_screenshot() {

	local scrot=`which scrot` # scrot is lighter
	local import=`which import` # imagemagick

	if [ -n "$scrot" ]; then

		if [ `whoami` == 'root' ]; then
			DISPLAY=:0 su $logged_user -c "$scrot $session__screenshot"
		else
			$scrot $session__screenshot
		fi

	elif [ -n "$import" ]; then

		local args="-window root -display :0"

		if [ `whoami` == 'root' ]; then # friggin su command, cannot pass args with "-" since it gets confused
			su $logged_user -c "$import $args $session__screenshot"
		else
			$import $args $session__screenshot
		fi

	fi
}
